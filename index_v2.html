<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>My Makeup List üíÑ</title>

<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
:root {
    --main-pink: #ff85a2;
    --soft-pink: #ffb7c5;
    --bg-pink: #fff0f3;
}

body { 
    font-family: 'Quicksand', sans-serif; 
    background: linear-gradient(135deg, #fff0f3 0%, #ffdde1 100%);
    margin: 0; padding: 15px; 
    min-height: 100vh;
    color: #5d4146;
}

.container { 
    max-width: 500px; 
    margin: auto;
    background: rgba(255, 255, 255, 0.9); 
    padding: 25px; 
    border-radius: 40px; 
    border: 4px solid white;
    box-shadow: 0 10px 25px rgba(255, 133, 162, 0.3);
    position: relative;
}

.container::before {
    content: "üéÄ";
    position: absolute;
    top: 10px;
    right: 20px;
    font-size: 30px;
}

h1 { 
    font-family: 'Dancing Script', cursive;
    text-align: center; 
    color: var(--main-pink);
    font-size: 2.5rem;
    margin-bottom: 20px;
}

.form-group { 
    display: flex; flex-direction: column; gap: 12px; 
    background: #fff9fb; padding: 20px; border-radius: 25px;
    border: 2px dashed var(--soft-pink);
}

input { 
    padding: 15px; 
    border-radius: 20px; 
    background: white;
    font-size: 16px;
    border: none;
    outline: none;
}

input:focus { border: 2px solid var(--main-pink); }

.btn-add { 
    background: linear-gradient(to right, #ff85a2, #ffacbd);
    color: white; 
    border: none; 
    padding: 15px; 
    border-radius: 50px; 
    font-weight: bold; 
    font-size: 18px;
    cursor: pointer;
}

.product-list { margin-top: 30px; }

.product-item { 
    display: flex; 
    align-items: center; 
    padding: 15px; 
    background: white;
    margin-bottom: 10px;
    border-radius: 20px;
    gap: 12px; 
}

.product-info { flex-grow: 1; font-weight: 600; }
.price { font-weight: bold; color: var(--main-pink); }

.btn-delete { 
    color: #ffb7c5; 
    border: none; 
    background: none; 
    font-size: 22px; 
    cursor: pointer;
}

.footer-actions { 
    margin-top: 30px; 
    text-align: center;
}

.total-box { 
    font-size: 1.5rem; 
    font-weight: bold;
    margin-bottom: 15px;
    font-family: 'Dancing Script', cursive;
}

.btn-pdf { 
    background: #5d4146; 
    color: white; 
    border: none; 
    padding: 15px; 
    border-radius: 50px; 
    font-weight: bold; 
    font-size: 16px; 
    width: 100%;
    cursor: pointer;
}
</style>
</head>

<body>

<div class="container">
<h1>Mon Maquillage</h1>

<div class="form-group">
<input type="text" id="p-name" placeholder="Nom du produit... üå∏">
<div style="display:flex; gap:10px;">
<input type="number" id="p-price" step="0.01" placeholder="Prix ‚Ç¨ üéÄ" style="width:45%">
<input type="text" id="p-ref" placeholder="R√©f√©rence üíï" style="width:55%">
</div>
<button class="btn-add" onclick="addProduct()">Ajouter</button>
</div>

<div id="list-container" class="product-list"></div>

<div class="footer-actions">
<div class="total-box">Total üí∂ : <span id="total-price" style="color:var(--main-pink)">0.00</span> ‚Ç¨</div>
<button class="btn-pdf" onclick="generatePDF()">T√©l√©charger ma liste üìÑ</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDGmfbaPISUa61LiiujPot7cIizq0cdQJ4",
  authDomain: "productlistexport.firebaseapp.com",
  databaseURL: "https://productlistexport-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "productlistexport",
  storageBucket: "productlistexport.firebasestorage.app",
  messagingSenderId: "329202845078",
  appId: "1:329202845078:web:61cd74b9ca8e58e0f109b7"
};

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);
const productsRef = ref(database, 'ma_liste_girly');

let products = [];

onValue(productsRef, (snapshot) => {
    const data = snapshot.val();
    products = data ? Object.entries(data).map(([id, val]) => ({ id, ...val })) : [];
    renderList();
});

window.addProduct = function() {
    const name = document.getElementById('p-name').value;
    const price = parseFloat(document.getElementById('p-price').value);
    const refValue = document.getElementById('p-ref').value;

    if (!name || !price || !refValue) return alert("Oups ! Il manque des infos !");

    push(productsRef, {
        name,
        price,
        ref: refValue,
        checked: true
    });

    document.getElementById('p-name').value = '';
    document.getElementById('p-price').value = '';
    document.getElementById('p-ref').value = '';
};

window.toggleProduct = function(id) {
    const product = products.find(x => x.id === id);
    update(ref(database, 'ma_liste_girly/' + id), {
        checked: !product.checked
    });
};

window.deleteProduct = function(id) {
    remove(ref(database, 'ma_liste_girly/' + id));
};

window.renderList = function() {
    const container = document.getElementById('list-container');
    container.innerHTML = '';
    let total = 0;

    products.forEach(p => {
        if (p.checked) total += p.price;

        const div = document.createElement('div');
        div.className = 'product-item';
        div.innerHTML = `
            <input type="checkbox" ${p.checked ? 'checked' : ''} onchange="toggleProduct('${p.id}')">
            <div class="product-info">${p.name}</div>
            <div class="price">${p.price.toFixed(2)}‚Ç¨</div>
            <button class="btn-delete" onclick="deleteProduct('${p.id}')">üóëÔ∏è</button>
        `;
        container.appendChild(div);
    });

    document.getElementById('total-price').innerText = total.toFixed(2);
};

window.generatePDF = function() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const selected = products.filter(p => p.checked);

    if (selected.length === 0) return alert("Ton panier est vide ! üõçÔ∏è");

    doc.setFontSize(20);
    doc.text("Ma Shopping List Magique", 14, 20);

    doc.autoTable({
        startY: 30,
        head: [['R√âF√âRENCE', 'ARTICLE', 'PRIX']],
        body: selected.map(p => [p.ref, p.name, p.price.toFixed(2) + " ‚Ç¨"]),
        foot: [['', 'TOTAL', document.getElementById('total-price').innerText + " ‚Ç¨"]],
        theme: 'grid'
    });

    doc.save("ma-liste-magique.pdf");
};
</script>

</body>
</html>